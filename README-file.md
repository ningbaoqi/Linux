### 操作文件系统
#### 创建分区
+ 必须在存储设备上创建分区来容纳文本系统，分区可以是整个硬盘，也可以是部分硬盘，以容纳虚拟目录的一部分；fdisk工具用来帮助管理安装在系统上的任何存储设备上的分区；要启动fdisk命令，必须指定要分区的存储设备的设备号，另外还得是有root权限；如果拥有超级用户权限并且指定正确的系统上的驱动器就可以进入fdisk工具的操作界面：`sudo fdisk /dev/sdb`；使用上述命令之后将会进入到fdisk工具界面，在工具界面可以输入命令，命令如下；

|命令|描述|
|------|------|
|`a`  |设置活动分区标志|
|`b `| 编辑BSD Unix系统用的磁盘标签|
|`c ` |设置DOS兼容标志|
|`d `| 删除分区|
|`l  `|显示可用的分区类型|
|`m`|  显示命令选项|
|`n ` |添加一个新分区，然后根据提示创建|
|`o `| 创建DOS分区表|
|`p `| 显示当前分区表|
|`q`  |退出不保存修改|
|`s` | 为SUN Unix 系统创建一个新磁盘标签|
|`t ` |修改分区的系统ID|
|`u` | 改变使用的存储单位|
|`v `|验证分区表|
|`w` | 将分区表写入磁盘，更改保存到存储设备上，存储设备的分区信息被写入分区表中，Linux系统提供ioctl()调用来获知新分区的出现，设置好分区之后可以使用Linux文件系统对其进行格式化|
|`x` | 高级功能|

+ 分区可以按primary partition 主分区和extended partition 扩展分区创建；主分区：可以被文件系统直接格式化；扩展分区：只能容纳其他逻辑分区；扩展分区的意义是：每个存储设备上只能有4个分区，这样就可以多分区扩展；

#### 创建文件系统
+ 在将数据存储到分区之前，必须用某种文件系统对其进行格式化，这样Linux才能使用它；

|创建文件系统的命令行程序|用途|
|------|------|
|`mkefs`|  创建一个ext文件系统|
|`mke2fs` | 创建一个ext2文件系统|
|`mkfs.ext3`  |创建ext3文件系统|
|`mkfs.ext4` |创建ext4文件系统；如：sudo mkfs.ext4 /dev/sdb1 （自己创建的分区）|
|`mkreiserfs`|  创建一个ReiserFS文件系统|
|`jfs_mkfs`|  创建一个JFS文件系统|
|`mkfs.xfs `| 创建一个XFS文件系统|
|`mkfs.zfs  `|创建一个ZFS文件系统|
|`mkfs.btrfs` | 创建一个Btrfs文件系统|

+ 创建完文件系统后，就应该将它挂载到虚拟目录下的某个挂载点，这样就可以将数据存储在新文件系统中了； `sudo mount -t ext4 /dev/sdb1 （分区） /mnt/my_partition （挂载目录）`：mount的-t选项指明了要挂载的文件系统类型ext4；这种挂载文件系统的方式只能临时挂载文件系统，当重启Linux系统时，文件系统就不会自动挂载，要强制Linux在启动时自动挂载新的文件系统，可以将其添加到/etc/fstab文件；所有以上步骤完成之后需要重启机器，才能生效，重启后，就可以正常操作了；

#### 文件系统的检查与修复
+ fsck命令能够检查和修复大部分类型的Linux文件系统，格式为：`fsck options filesystem`：可以在命令行上列出多个要检查的文件系统，文件系统可以通过设备名、在虚拟目录中的挂载点以及分配给文件系统的唯一UUID值来引用；

|fsck命令行的选项|描述|
|------|------|
|`-a ` |如果检查到错误，自动修复文件系统|
|`-A`  |检查/etc/fstab文件中列出的所有文件系统|
|`-C`  |给支持进度条功能的文件系统显示一个进度条（只有ext2和ext3）|
|`-N`  |不进行检查，只显示哪些检查会执行|
|`-r ` |出现错误时提示|
|`-R`  |使用-A选项时跳过根文件系统|
|`-s ` |检查多个文件系统时，一次进行检查|
|`-t ` |指定要检查的文件系统类型|
|`-T ` |启动时不显示头部信息|
|`-V ` |在检查时产生详细输出|
|`-y`  |检查到错误时自动修复文件系统|

+ 只能在未挂载的文件系统上运行`fsck`命令；


### 逻辑卷管理
#### 快照
+ 在逻辑卷在线的状态下将其复制到另一个设备，这种功能叫做快照；
#### 条带化
+ 有了条带化可以跨多个物理硬盘创建逻辑卷，条带化有助于提高硬盘的性能，因为Linux可以将一个文件的多个数据块同时写入多个硬盘，而无需等待单个硬盘移动读写磁头到多个不同位置，因为逻辑卷可同时从多个硬盘读取数据；
#### 镜像
+ 镜像是一个实时更新的逻辑卷的完整副本，当创建镜像逻辑卷时，LVM会将原始逻辑卷同步到镜像副本中；
#### 使用LinuxLVM(逻辑卷管理器)
##### 定义物理卷
+ 第一步：将硬盘上的物理分区转换成Linux LVM使用的物理卷区段，在创建了基本的Linux分区之后，你需要通过t命令改变分区类型；分区类型8e表示这个分区将会被用作LinuxLVM系统的一部分，而不是一个直接的文件系统；第二步：用分区来创建实际的物理卷，可以通过pvcreate命令来完成，pvcreate定义了用于物理卷的物理分区，它只是简单的将分区标记成LinuxLVM系统中的分区而已；`sudo pvcreate /dev/sdb`；查看创建进度，可以使用pvdisplay命令来显示已创建的物理卷列表；`sudo pvdisplay /dev/sdb1`；
##### 创建卷组
+ vgcreate命令需要一些命令行参数来定义卷组名以及你用来创建卷组的物理卷组；`vgcreate VOLL（卷组名） /dev/sdb1`；查看新建的卷组细节使用命令：`vgdisplay VOLL`； 创建一个或多个卷组后就可以创建逻辑卷了；
##### 创建逻辑卷
+ Linux系统使用逻辑卷来模拟物理分区，并在其中保存文件系统，Linux系统会像处理物理分区一样处理逻辑卷，允许你定义逻辑卷中的文件系统，然后将文件系统挂载到虚拟目录上；创建逻辑卷命令：`lvcreate`；

|lvcreate命令选项|描述|
|------|------|
|`-c ` |指定快照逻辑卷的单位大小|
|`-C` | 设置或重置连续分配策略|
|`-i`  |指定条带数|
|`-I`  |指定每个条带的大小|
|`-l`  |指定分配给新逻辑卷的逻辑区段数，或者要用的逻辑区段的百分比|
|`-L ` |指定分配的新逻辑卷的硬盘大小|
|`-m` | 创建逻辑卷镜像|
|`-M` | 让次设备号一直有效|
|`-n`  |指定新逻辑卷的名称|
|`-p` | 为逻辑卷设置读写权限|
|`-R` | 指定将镜像分成多大的区|
|`-r ` |设置预读扇区数|
|`-s`  |创建快照逻辑卷|
|`-Z` | 将新逻辑卷的前1KB数据设置为零|

+ `sudo lvcreate -l 100%FREE -n lvtest VOLL`；查看逻辑卷的详细信息，可用lvdisplay 如：`lvdisplay VOLL`；执行完lvcreate，逻辑卷就产生了，但是还没有文件系统，因而必须使用相应的命令来创建文件系统；

##### 创建文件系统
+ `sudo mkfs.ext4 /dev/VOLL/lvtest`；创建了文件系统之后就可以使用mount命令来将这个卷挂载到虚拟目录中，就是跟物理分区一样，唯一的不同就是你需要使用特殊的路径来标识逻辑卷；`sudo mount /dev/VOLL/lvtest /mnt/my_partition`：路径中使用了卷组名和逻辑卷名，而不是物理分区路劲，文件系统被挂载之后就可以使用了；

##### 修改LVM

+ Linux LVM的好处在于能够动态修改文件系统；

|LinuxLVM命令|功能|
|------|------|
|`vgchange`|  激活和禁用卷组|
|`vgremove`|  删除卷组|
|`vgextend` | 将物理卷加到卷组中|
|`cgreduce` | 从卷组中删除物理卷|
|`lvextend ` |增加逻辑卷的大小|
|`lvreduce `| 减小逻辑卷的大小|
